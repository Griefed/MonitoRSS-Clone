#!/usr/bin/with-contenv bash

DEFAULT_REDIRECT_URI='http://localhost:8081/authorize'

if [ ! -f /config/config.bot.json ]; then
  cp /defaults/config.bot.json \
     /config/config.bot.json
fi

if [ ! -f /config/config.web.json ]; then
  cp /defaults/config.web.json \
     /config/config.web.json
fi

if [ ! -f /config/schedules.json ]; then
  cp /defaults/schedules.json \
     /config/schedules.json
fi

if [ "$DRSS_START" = "web" ]; then
sed -i \
  "s/DRSSWEB_BOT_REDIRECTURI/${DRSSWEB_BOT_REDIRECTURI}/g" \
  /config/config.web.json
else
  sed -i \
  "s/DRSSWEB_BOT_REDIRECTURI/${DEFAULT_REDIRECT_URI}/g" \
  /config/config.web.json
fi
chown -R \
  abc:abc \
    /app/monitorss \
    /config

ln -sf /config/config.bot.json /app/monitorss/settings/config.bot.json
ln -sf /config/config.web.json /app/monitorss/settings/config.web.json
ln -sf /config/schedules.json /app/monitorss/settings/schedules.json